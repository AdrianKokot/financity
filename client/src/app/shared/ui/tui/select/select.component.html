<ng-container *tuiLet="(stringify$ | async)! as stringify">
  <tui-combo-box
    (ngModelChange)="writeValue($event)"
    (searchChange)="search$.next($event ?? '')"
    *tuiLet="items$ | async as items"
    [ngModel]="value"
    [strict]="true"
    [stringify]="stringify"
    [tuiTextfieldLabelOutside]="true"
    tuiTextfieldSize="m">
    {{ label }}

    <input placeholder="Search" tuiTextfield />

    <cdk-virtual-scroll-viewport
      (pageChange)="page$.next($event)"
      *tuiDataList
      [itemSize]="36"
      [minBufferPx]="200"
      [style.--items-count]="(items ?? []).length"
      appInfiniteVirtualScroll
      class="viewport tui-zero-scrollbar"
      tuiScrollable>
      <ng-container *tuiLet="apiLoading$ | async as apiLoading">
        <tui-data-list *ngIf="items; else loading" size="s">
          <button *cdkVirtualFor="let item of items" [value]="item" tuiOption>
            {{ stringify(item) }}
          </button>
          <tui-loader *ngIf="apiLoading" class="mb-1"></tui-loader>
        </tui-data-list>
        <ng-template #loading>
          <tui-loader *cdkVirtualFor="let i of [0]" class="mt-1"></tui-loader>
        </ng-template>
      </ng-container>
    </cdk-virtual-scroll-viewport>
  </tui-combo-box>
</ng-container>
